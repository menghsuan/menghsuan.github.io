<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>聊播 -聊天交友 APP</title>
    <link rel="stylesheet" type="text/css" href="mobile.css">
  </head>

  <body>
    <div class="WRAPPER">
      <div class="HEAD H45">
        <div class="CONTENT">
          <div class="MD_W">
            <div class="LEFT_BTN"><!--div class="btn_icon_block" onclick="javascript:location.href='../index.html'"><img class="btn_icon_img" src="images/bell.png"></div--></div>
            <div class="CENTER"><h3 class="TITLE"></h3></div>          
            <div class="RIGHT_BTN"><div id="TOP_FILTER_BTN" class="btn_icon_block"><img class="btn_icon_img" src="images/filter.png"></div></div>
          </div>
        </div>
      </div>

      <div class="MAIN">
        <div class="CONTENT">

          <div class="MATCH_CARD">

            <div class="DEMO_INFO" onclick="this.style.display = 'none'">
              <div class="CLICK_PREVIOUS"><img class="IC_IMAGE" src="images/point_left.png"><p class="h4">查看上一張照片</p></div>
              <div class="CLICK_NEXT"><img class="IC_IMAGE" src="images/point_right.png"><p class="h4">查看下一張照片</p></div>
              <div class="CLICK_MORE"><p class="h4">開啟個人資料頁</p><img class="IC_IMAGE" src="images/point_right.png"></div>
            </div>

            <div class="DEMO_INFO" onclick="this.style.display = 'none'">
              <div class="TEXT"><img class="IC_IMAGE ROTATE_L" src="images/point_right.png"><h3>想跳過就向左滑</h3><p class="h4">若對方不是你的菜就跳過吧</p></div>
              <div class="BG_PHOTO"><img src="images/photos/02.jpg"></div>
            </div>
            
            <div class="DEMO_INFO" onclick="this.style.display = 'none'">
              <div class="TEXT"><img class="IC_IMAGE ROTATE_R" src="images/point_right.png"><h3>喜歡的話向右滑</h3><p class="h4">只要彼此都向右滑就配對成功囉~</p></div>
              <div class="BG_PHOTO"><img src="images/photos/01.jpg"></div>
            </div>

            <div id="dot" class="PROGRESS_BAR dot-container">
              <div id="dot-1" class="PROGRESS_ITEM dot PROGRESS_ITEM_ON"></div><div id="dot-2" class="PROGRESS_ITEM dot"></div><div id="dot-3" class="PROGRESS_ITEM dot"></div><div id="dot-4" class="PROGRESS_ITEM dot"></div><div id="dot-5" class="PROGRESS_ITEM dot"></div>
            </div>
            <span id="previous" class="CLICK_PREVIOUS arrow--prev"></span>
            <span id="next" class="CLICK_NEXT arrow--next"></span>
            <span id="more" class="CLICK_MORE" onclick="javascript:location.href='detail_page.html'"> <span class="BTN_MORE_UP"></span></span>
            <div id="slider" class="SLIDER slider">
              <ul class="slider__img-container">
                <li class="SLIDER_PHOTO slide"><img src="images/photos/01.jpg" alt="" class="slide__img"></li>
                <li class="SLIDER_PHOTO slide"><img src="images/photos/02.jpg" alt="" class="slide__img"></li>
                <li class="SLIDER_PHOTO slide"><img src="images/photos/03.jpg" alt="" class="slide__img"></li>
                <li class="SLIDER_PHOTO slide"><img src="images/photos/04.jpg" alt="" class="slide__img"></li>
                <li class="SLIDER_PHOTO slide"><img src="images/photos/05.jpg" alt="" class="slide__img"></li>
              </ul>
            </div>
            <div class="INFO">
              <div class="TOP"><h1 class="NAME">Naomi</h1><span class="AGE h2">28</span><img class="VERIFY" src="images/verify.png"></div>
              <div class="TAGS"><span class="TAG"><img class="IC_IMAGE" src="images/horoscope_w.png">雙魚座</span><span class="TAG"><img class="IC_IMAGE" src="images/location_w.png">台北市</span><span class="TAG"><img class="IC_IMAGE" src="images/work_w.png">服務業</span></div>
              <!--div class="TAGS"><span class="TAG">瑜珈</span><span class="TAG">咖啡</span><span class="TAG">Netflix</span><span class="TAG">異國料理</span><span class="TAG">探索新城市</span></div-->
              <div class="ABOUT">如已婚、非單身、找包養，<br>請左滑相互尊重 輕鬆聊~<br>第三行測試</div>
            </div>
            <div class="MATCH_ACTION">
              <div class="BTN_DISLIKE"><img src="images/dislike.png"></div>
              <div class="BTN_LIKE" onclick="location.href='match.html';"><img src="images/like.png"></div>
            </div>
          </div>

        </div>
      </div>

      <div class="BOTTOM H48">
        <div class="CONTENT">
          <div class="TAB_MENU">
            <div class="TAB_BTN" onclick="javascript:location.href='../index.html'"><img class="btn_icon_img" src="images/tab_match_on.png"> </div>
            <div class="TAB_BTN" onclick="javascript:location.href='group/'"><img class="btn_icon_img" src="images/tab_group_off.png"> </div>
            <div class="TAB_BTN" onclick="javascript:location.href='chat/'"><img class="btn_icon_img" src="images/tab_chat_off.png"> </div>
            <div class="TAB_BTN" onclick="javascript:location.href='menu/'"><img class="btn_icon_img" src="images/tab_me_off.png"> </div>
          </div>
        </div>
      </div>

    </div>


    <!-- 篩選選單 -->
    <div id="FORM_FILTER" class="FORM_FILTER WRAPPER" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: none; animation: slideLeft 0.3s; background-color: #ffffff;">

      <div class="TOP_MENU H45">
        <div class="MD_W">
          <div class="LEFT_BTN"></div>
          <div class="CENTER"><h3 class="TITLE">篩選</h3></div>          
          <div class="RIGHT_BTN"><div id="CLOSE_BTN" class="btn_icon_block"><img class="btn_icon_img" src="images/close.png"></div></div>
        </div>
      </div>

      <div class="MAIN">
        <div class="CONTENT GROWFULL">
          <div class="SECTION">
            <h5 class="SUBTITLE">向我展示</h5>
            <div class="FORM_FIELD">
              <label class="RADIOBOX_ITEM"><div class="LABEL_TEXT"><h4 class="TITLE">男性</h4></div><input class="RADIO_INPUT" type="radio" name="genderOptions" value="male" checked=""><span class="RADIO"></span></label>
              <label class="RADIOBOX_ITEM"><div class="LABEL_TEXT"><h4 class="TITLE">女性</h4></div><input class="RADIO_INPUT" type="radio" name="genderOptions" value="female"><span class="RADIO"></span></label>
              <label class="RADIOBOX_ITEM"><div class="LABEL_TEXT"><h4 class="TITLE">不限</h4></div><input class="RADIO_INPUT" type="radio" name="genderOptions" value="all"><span class="RADIO"></span></label>
            </div>
          </div>

          <div class="SECTION">
            <h5 class="SUBTITLE">距離<span class="INFO brand">100km+</span></h5>
            <div class="FORM_FIELD">
              <div class="RANGE">
                <div class="RANGE_SLIDER">
                  <span class="RANGE_SELECTED" style="left: 0%; width: 80%"></span>
                </div>
                <div class="RANGE_INPUT">
                  <input type="range" id="" name="" min="0" max="100" value="80">
                </div>
              </div>
            </div>
            <div class="FORM_FIELD">
              <label id="" class="TOGGLEBOX_ITEM ON"><div class="LABEL_TEXT"><h4 class="TITLE">自動擴大搜索範圍</h4><span class="SUB">若附近適合的對象較少，會自動擴大範圍</span></div><span class="checkmark"></span></label>
            </div>
          </div>

          <div class="SECTION">
            <h5 class="SUBTITLE">年齡<span class="INFO brand">18 - 100+</span></h5>
            <div class="FORM_FIELD">
              <div class="RANGE">
                <div class="RANGE_SLIDER">
                  <span class="RANGE_SELECTED" style="left: 0%; right: 0%;"></span>
                </div>
                <div class="RANGE_INPUT">
                  <input type="range" id="" name="" min="18" max="100" value="18">
                  <input type="range" id="" name="" min="18" max="100" value="100">
                </div>
              </div>
            </div>
            <div class="FORM_FIELD">
              <label id="" class="TOGGLEBOX_ITEM"><div class="LABEL_TEXT"><h4 class="TITLE">僅顯示此範圍的對象</h4></div><span class="checkmark"></span></label>
            </div>            
          </div>

        </div>
      </div>

      <div class="BOTTOM H65">
        <div class="CONTENT">
          <div class="FORM_BTN">
            <div class="BTN" onclick="javascript:location.href='index.html'"><span>送出</span></div>
          </div>
        </div>
      </div>

    </div>
    <!-- 篩選選單 end -->


    <script>
      let img_width = document.querySelector('.slider').clientWidth;
      const imgs_container = document.querySelector('.slider__img-container');
      const imgs = document.querySelectorAll('.slide');
      const total_imgs = imgs.length;

      // 因為 dom 的設定，這個容器變成最上層...(滑鼠的點擊事件都會在這裡)
      const arrow_dot_container = document.querySelector('.slider__arrow-nav-container');

      const dots_container = document.querySelector('.dot-container');
      const prev_btn = document.querySelector('.arrow--prev');
      const next_btn = document.querySelector('.arrow--next');

      const slide_seconds = 4000;
      let current_index = 1;  // 記錄現在跑的位置
      let last_index;         // 把上一個的 Class 清除
      let move_distance;      // 每張圖片需要移動的距離
      let timer;

      let mouse_is_down = false;     // 是否按住滑鼠
      let mouse_position_x = [0, 0]; // 記錄滑鼠開始和結束的位置 

      /** * 計算往下一張的距離 * 左邊作為預設的 slide 方向 */ 
      function calculateNextDistance() {
        move_distance = -(current_index * img_width); // 圖片的 index 位置 x 容器寬度。 ex.輪播二 2 x 800 = 1600
        last_index = current_index;

        //  往愈大張方向移動，不斷遞增，需考慮移到最後一張時的邏輯
        if (current_index == total_imgs) {
          current_index = 1;
          move_distance = 0;
        } else {
          current_index++;
        }
        slideImages();
      }


      /*** 計算往上一張的距離* 只有按 Prev Btn 才會觸發 */
      function calculatePrevDistance() {
        // 往愈小張方向移動，不斷遞減，需考慮移到第一張時的邏輯 
        // 注意：current_index 不能 = 0，因為 dot id 是從 1 ～ 5 排序，
        // 不然 slideImages() 會爛掉，抓不到 #dot-${current_index} 的值
        if (current_index > 1) {
          last_index = current_index;
          current_index--;
          move_distance = move_distance + img_width; // 已記錄正在跑的 move_distance (為負值) + 容器寬度
        } else {
          last_index = current_index;
          current_index = total_imgs;
          move_distance = -((total_imgs - 1) * img_width);
        }
        slideImages();
      }


      /*** 移動圖片 */
      function slideImages(drag_distance) {
        clearInterval(timer);

        // 若沒有傳入值，則使用全域 move_distance 做為移動距離;
        const distance = drag_distance || move_distance;

        imgs_container.style.transform = `translateX(${distance}px)`;
        document.querySelector(`#dot-${last_index}`).classList.remove('PROGRESS_ITEM_ON');
        document.querySelector(`#dot-${current_index}`).classList.add('PROGRESS_ITEM_ON');

        timer = setInterval(calculateNextDistance, slide_seconds);

        // console.log(`current_index: ${current_index}, last_index: ${last_index} || img_width: ${img_width} || move_distance: ${move_distance} || container_width: ${imgs_container.style.width}`)
      }


      /*** 點選 dot，計算距離、換成對應的圖片 */
      function slideDotImages(e) {
        const dots = this.querySelectorAll('.dot');

        // 跑完所有 dot，和點選到的 dot 做比對
        // 注意 last_index 和 current_index 的優先順序
        for (var i = 1; i <= dots.length; i++) {
          if (e.target.id == `dot-${i}`) {
            last_index = current_index;
            current_index = i;
            move_distance = -((current_index - 1) * img_width);
          }
        }
        slideImages();
      }


      /** * 製造拖曳預覽效果 */
      function createDraggingEffects(e) {
        // 記錄正在移動的最後位置

        mouse_position_x[1] = e.clientX;
        if (mouse_position_x[0] == mouse_position_x[1]) {
          return false;
        }

        // 拖曳預覽效果
        // 還沒真的變換圖片，判斷滑鼠拖曳多少，圖片該跟著移動多少
        let scrolled_distance = Math.abs((mouse_position_x[0] - mouse_position_x[1]));
        const weight = img_width / 12; // 讓圖片被拖曳的效果更明顯，除數 12 愈大效果愈差

        if (mouse_position_x[0] > mouse_position_x[1]) {  // 往下一張
          scrolled_distance = move_distance - scrolled_distance - weight;
        } else { // 往上一張
          scrolled_distance = move_distance + scrolled_distance + weight;
        }

        slideImages(scrolled_distance); 

        console.log(current_index)
        console.log(mouse_position_x);
      }


      /*** 拖曳變換圖片 */
      function dragAndSlideImages() {
        if (mouse_position_x[0] == mouse_position_x[1]) {
          slideImages();
          return false;
        }

        // 如果滑鼠移動差距很小(不超過30)，就不要換圖片，彈回到原本的位置
        // 不加 abs ，相減出來會變負數
        if (Math.abs(mouse_position_x[0] - mouse_position_x[1]) < 30) {
          slideImages(); // 原本拖曳第2張一點點，讓它在回到第2張最初的位置
          return false; // 不繼續執行以下
        }

        // 變換圖片
        // 往前、往後拖曳 = 按前、後按鈕的原理
        if (mouse_position_x[0] > mouse_position_x[1]) {
          calculateNextDistance();
        } else {
          calculatePrevDistance();
        }
      }


      /*** 初始化 */
      function init() {
        document.querySelector(`#dot-${current_index}`).classList.remove('is-active');

        img_width = document.querySelector('.slider').clientWidth;
        imgs.forEach(img => img.style.width = `${img_width}px`);
        imgs_container.style.width = `${img_width * total_imgs}px`;

        current_index = total_imgs;
        calculateNextDistance();
      }

      init();

      next_btn.addEventListener('click', calculateNextDistance);
      prev_btn.addEventListener('click', calculatePrevDistance);
      dots_container.addEventListener('click', slideDotImages);
      window.addEventListener('resize', init);


      //arrow_dot_container.addEventListener('mousedown', (e) => {
      //  mouse_is_down = true;

      //  clearInterval(timer);

      // 記錄當下的位置
      //  mouse_position_x = [e.clientX, 0];
      //  arrow_dot_container.style.cursor = '-webkit-grabbing';
      //  console.log(mouse_position_x);
      //})

      //arrow_dot_container.addEventListener('mousemove', (e) => {
      // 在 mouse is down (滑鼠已經按壓) 的狀態下才可執行以下程式，不然滑鼠一進 container 圖片就會滑動
      //  if (!mouse_is_down) return false; 
      //  createDraggingEffects(e);
      //})

      //arrow_dot_container.addEventListener('mouseup', (e) => {
      //  mouse_position_x[1] = e.clientX;
      //  dragAndSlideImages(e);
      //  mouse_is_down = false;
      //  arrow_dot_container.style.cursor = '';

      //  console.log(current_index);
      //})

      //arrow_dot_container.addEventListener('mouseleave', () => {
      //  if (!mouse_is_down) return false;

      //  mouse_position_x = [0, 0];
      //  dragAndSlideImages();
      //  mouse_is_down = false;
      //  arrow_dot_container.style.cursor = ''; 
      //})

    </script>

    <script>
      var TOP_FILTER_BTN = document.getElementById("TOP_FILTER_BTN");
      //var TOP_SELECTED = document.getElementById("TOP_SELECTED");
      var FORM_FILTER = document.getElementById("FORM_FILTER");
      var CLOSE_BTN = document.getElementById("CLOSE_BTN");
      TOP_FILTER_BTN.onclick = function() {
        FORM_FILTER.style.display = "flex";
      }
      CLOSE_BTN.onclick = function() {
        FORM_FILTER.style.display = "none";
      }
    </script>


  </body>
</html>